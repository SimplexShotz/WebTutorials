<!DOCTYPE html>
<html>
  <head>
    <title>Web Tutorials - Editor</title>
    <script src="/WebTutorials/root/javascript.js"></script>
    <link rel="stylesheet" href="/WebTutorials/root/stylesheet.css">
    <link rel="icon" href="/WebTutorials/root/favicon.png">
    <style>
      #content {
        background-color: rgb(255, 255, 255);
        margin: 0px 5% 0px 5%;
        padding: 5%;
      }
      #code {
        width: calc(50% - 20px);
        background-color: rgb(255, 255, 255);
        color: rgb(0, 0, 0);
        font-family: Helvetica;
        border-color: rgb(225, 225, 225);
        padding: 0px;
        resize: none;
      }
      #code:focus {
        outline: 0;
        border-color: rgb(200, 200, 200);
      }
      #webpage {
        width: calc(50% - 20px);
        background-color: rgb(255, 255, 255);
        color: rgb(0, 0, 0);
        font-family: Helvetica;
        border: 1px solid rgb(225, 225, 225);
        padding: 0px;
      }
      .surround {
        width: calc(50% - 20px);
        padding: 0px;
        margin: 0px;
      }
    </style>
  </head>
  <body>
    <div id="header">
      Web Tutorials - Editor
      <div id="navbar">
        <a class="nb-d" href="/WebTutorials">Home</a><div class="nb-d-s">&nbsp</div><a class="nb-d" href="/WebTutorials/help.html">Help</a><div class="nb-d-s">&nbsp</div><a class="nb-d" href="/WebTutorials/Editor">Editor</a>
      </div> <!-- #navbar -->
    </div> <!-- #header -->
    <div id="navbar-mobile">
      <a class="nb-m" href="/WebTutorials">Home</a><div class="nb-m-s">&nbsp</div><a class="nb-m" href="/WebTutorials/help.html">Help</a><div class="nb-m-s">&nbsp</div><a class="nb-m" href="/WebTutorials/Editor">Editor</a>
    </div> <!-- #navbar-mobile -->
    <div id="content">
      <div class="surround" style="float: left;">
        <h1>Web Editor</h1>
        <textarea id="code"></textarea>
      </div> <!-- .surround -->
      <div class="surround" style="float: right;">
        <h1>Title</h1>
        <iframe id="webpage"></iframe>
      </div> <!-- .surround -->
    </div> <!-- #content -->
    <div id="footer">
      Copyright 2018 IC
    </div> <!-- footer -->
    <script>
      function getStyle(cd) {
        var c = cd.split("");
        var st = [];
        for (var i = 0; i < c.length; i++) {
          if (c[i] === "<" && i < c.length - 6) {
            if (c[i + 1].toLowerCase() === "s" && c[i + 2].toLowerCase() === "t" && c[i + 3].toLowerCase() === "y" && c[i + 4].toLowerCase() === "l" && c[i + 5].toLowerCase() === "e" && c[i + 6] === ">") {
              st.push("");
              for (var r = 0; r < 10000; r++) {
                if (c[i + 7 + r] === "<" && i + 7 + r < c.length - 7) {
                  if (c[i + 7 + r + 1] === "/" && c[i + 7 + r + 2].toLowerCase() === "s" && c[i + 7 + r + 3].toLowerCase() === "t" && c[i + 7 + r + 4].toLowerCase() === "y" && c[i + 7 + r + 5].toLowerCase() === "l" && c[i + 7 + r + 6].toLowerCase() === "e" && c[i + 7 + r + 7] === ">") {
                    break;
                  }
                }
                st[st.length - 1] += c[i + 7 + r];
              }
            }
          }
        }
        return st;
      };
      function getScript(cd) {
        var c = cd.split("");
        var st = [];
        for (var i = 0; i < c.length; i++) {
          if (c[i] === "<" && i < c.length - 7) {
            if (c[i + 1].toLowerCase() === "s" && c[i + 2].toLowerCase() === "c" && c[i + 3].toLowerCase() === "r" && c[i + 4].toLowerCase() === "i" && c[i + 5].toLowerCase() === "p" && c[i + 6].toLowerCase() === "t" && c[i + 7] === ">") {
              st.push("");
              for (var r = 0; r < 10000; r++) {
                if (c[i + 8 + r] === "<" && i + 8 + r < c.length - 8) {
                  if (c[i + 8 + r + 1] === "/" && c[i + 8 + r + 2].toLowerCase() === "s" && c[i + 8 + r + 3].toLowerCase() === "c" && c[i + 8 + r + 4].toLowerCase() === "r" && c[i + 8 + r + 5].toLowerCase() === "i" && c[i + 8 + r + 6].toLowerCase() === "p" && c[i + 8 + r + 7].toLowerCase() === "t" && c[i + 8 + r + 8] === ">") {
                    break;
                  }
                }
                st[st.length - 1] += c[i + 8 + r];
              }
            }
          }
        }
        return st;
      };
      setTimeout(() => {
        if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|BB|PlayBook|IEMobile|Windows Phone|Kindle|Silk|Opera Mini/i.test(navigator.userAgent)) {
          document.getElementById("code").style.height = "calc(" + window.innerHeight + "px - 50pt - 235px - " + (window.innerWidth / 10) + "px - 30pt - 30pt - 40pt - 30pt)";
          document.getElementById("webpage").style.height = "calc(" + window.innerHeight + "px - 50pt - 235px - " + (window.innerWidth / 10) + "px - 30pt - 30pt - 40pt - 30pt)";
          document.getElementById("code").style.fontSize = "16pt";
        } else {
          document.getElementById("code").style.height = "calc(" + window.innerHeight + "px - 14pt - 95px - " + (window.innerWidth / 10) + "px - 12pt - 12pt - 16pt)";
          document.getElementById("webpage").style.height = "calc(" + window.innerHeight + "px - 14pt - 95px - " + (window.innerWidth / 10) + "px - 12pt - 12pt - 16pt)";
          setInterval(() => {
            document.getElementById("code").style.height = "calc(" + window.innerHeight + "px - 14pt - 95px - " + (window.innerWidth / 10) + "px - 12pt - 12pt - 16pt)";
            document.getElementById("webpage").style.height = "calc(" + window.innerHeight + "px - 14pt - 95px - " + (window.innerWidth / 10) + "px - 12pt - 12pt - 16pt)";
          }, 1000);  
          document.getElementById("code").style.fontSize = "10pt";
        }
        var html = document.getElementById("code"),
            webpage = document.getElementById("webpage");
        var working = false;
        function update() {
          if (working) {
            return false;
          }
          working = true;
          var document = webpage.contentDocument,
              style = document.createElement("style"),
              script = document.createElement("script");
          document.body.innerHTML = html.value;
          var styles = getStyle(html.value);
          for (var i = 0; i < styles.length; i++) {
            style.innerHTML += styles[i];
          }
          var scripts = getScript(html.value);
          for (var i = 0; i < scripts.length; i++) {
            script.innerHTML += scripts[i];
          }
          document.body.appendChild(style);
          document.body.appendChild(script);
          working = false;
        }
        document.getElementById("code").onkeyup = update;
        update();
      }, 0);
//       var pcode = "";
//       setInterval(() => {
//         if (document.getElementById("code").value !== pcode) {
//           document.getElementById("webpage").innerHTML = document.getElementById("code").value;
//         }
//         pcode = document.getElementById("code").value;
//       }, 1000);
      document.getElementById("code").onkeydown = function(e) {
        if (e.keyCode === 9 || e.which === 9) {
          e.preventDefault();
          var s = this.selectionStart;
          this.value = this.value.substring(0, this.selectionStart) + "  " + this.value.substring(this.selectionEnd);
          this.selectionEnd = s + 2; 
        }
      }
      function getQuery(variable) {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i = 0; i < vars.length; i++) {
          var pair = vars[i].split("=");
          if (pair[0] == variable) {
            return pair[1];
          }
        }
        return(false);
      }
      var code = "";
      switch(getQuery("C")) {
        case "1":
          switch(getQuery("L")) {
            case "1":
              code = "<!DOCTYPE html>\n<html>\n  <head>\n  </head>\n  <body>\n  </body>\n</html>";
            break;
            case "2":
              code = "<!DOCTYPE html>\n<html>\n  <head>\n    <title>Put your title here!</title>\n  </head>\n  <body>\n    <h1>This header is largest!</h1>\n    <h3>This header is large!</h3>\n    <h4>This header is small.</h4>\n    <h6>This header is smallest.</h6>\n  </body>\n</html>";
            break;
            default:
              if (getQuery("L")) {
                alert("That lesson does not exist!");
              }
            break;
          }
        break;
        default:
          if (getQuery("C")) {
            alert("That chapter does not exist!");
          }
        break;
      }
      document.getElementById("code").value = code;
    </script> <!-- Get Query -->
  </body>
</html>
